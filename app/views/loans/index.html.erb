<h1>Loans</h1>

<form class="pure-form" method="get" id="loan_search">
  <fieldset>
    <legend>Filter loans</legend>

    <input type="text" placeholder="Loan Name" name="name">
    <input type="text" placeholder="User Name" name="user_name">
    Invested within:
    <select name="period" id="period_combo">
      <% %w(3 6 9 12).each do |m| %>
          <option value="<%= m %>" <%= m == @period.to_s ? 'selected="true"' : '' %>>Last <%= m %> months</option>
      <% end %>
      <option value="all" <%= 'all' == @period.to_s ? 'selected="true"' : '' %>>All Time</option>
    </select>
    <% %w(repaid active overdue funding).each do |state| %>
    <input type="checkbox" name="<%= state %>" value="1" <%= @states[state] ? 'checked="true"' : '' %>> <%= state.capitalize %>
    <% end %>
    <br><input type="submit" value="search" class="pure-button pure-button-primary">
  </fieldset>

  <fieldset>
    <legend class="expand">Select Columns</legend>

    <div class="collapse">
      <!-- tables for layout? sue me, I'm lazy -->
      <table id="column_selector">
        <tr>
          <td>
            <input type="checkbox" name="columns[]" value="id" <%= @columns.include?('id') ? 'checked="true"' : '' %>> <strong>ID:</strong> BTC Jam ID
          </td>
          <td>
            <input type="checkbox" name="columns[]" value="name" <%= @columns.include?('name') ? 'checked="true"' : '' %>> <strong>Name:</strong> Loan name
          </td>
        </tr>
        <tr>
          <td>
            <input type="checkbox" name="columns[]" value="user_name" <%= @columns.include?('user_name') ? 'checked="true"' : '' %>> <strong>User Name:</strong> Name of BTC Jam user
          </td>
          <td>
            <input type="checkbox" name="columns[]" value="loan_link" <%= @columns.include?('loan_link') ? 'checked="true"' : '' %>> <strong>Loan Link:</strong> Link to BTC Jam's loan page
          </td>
        </tr>
        <tr>
          <td>
            <input type="checkbox" name="columns[]" value="user_link" <%= @columns.include?('user_link') ? 'checked="true"' : '' %>> <strong>User Link:</strong> Link to BTC Jam user's page
          </td>
          <td>
            <input type="checkbox" name="columns[]" value="state" <%= @columns.include?('state') ? 'checked="true"' : '' %>> <strong>State:</strong> State of loan (funding, active, repaid or overdue)
          </td>
        </tr>
        <tr>
          <td>
            <input type="checkbox" name="columns[]" value="amount" <%= @columns.include?('amount') ? 'checked="true"' : '' %>> <strong>Amount:</strong> Advertised amount of loan
          </td>
          <td>
            <input type="checkbox" name="columns[]" value="btc_per_payment" <%= @columns.include?('btc_per_payment') ? 'checked="true"' : '' %>> <strong>BTC Per Payment:</strong> Amount to be paid per-payment
          </td>
        </tr>
        <tr>
          <td>
            <input type="checkbox" name="columns[]" value="term" <%= @columns.include?('term') ? 'checked="true"' : '' %>> <strong>Term:</strong> Length of loan in days
          </td>
          <td>
            <input type="checkbox" name="columns[]" value="payment_count" <%= @columns.include?('payment_count') ? 'checked="true"' : '' %>> <strong>Payment count:</strong> Total number of payments to be repaid
          </td>
        </tr>
        <tr>
          <td>
            <input type="checkbox" name="columns[]" value="total_to_repay" <%= @columns.include?('total_to_repay') ? 'checked="true"' : '' %>> <strong>Total to repay:</strong> Amount to be repaid, including interest
          </td>
          <td>
            <input type="checkbox" name="columns[]" value="return" <%= @columns.include?('return') ? 'checked="true"' : '' %>> <strong>% return:</strong> Percentage of initial investment made as profit, when repaid
          </td>
        </tr>
        <tr>
          <td>
            <input type="checkbox" name="columns[]" value="apr" <%= @columns.include?('apr') ? 'checked="true"' : '' %>> <strong>APR:</strong> Annual interest rate on loan
          </td>
          <td>
            <input type="checkbox" name="columns[]" value="date" <%= @columns.include?('date') ? 'checked="true"' : '' %>> <strong>Date:</strong> Date of most recent investment in loan
          </td>
        </tr>
      </table>

    </div>
  </fieldset>
</form>

<table class="pure-table">
  <thead id="table_header">
  <%= render 'loans_table_header', loans: @loans %></thead>
  <tbody id="loan_content">
  <%= render 'loans_table_content', loans: @loans %>
  </tbody>
</table>

<div id="pagina">
  <%= will_paginate @loans %>
</div>
